EXT := cu 

OBJS := rinterface.o mi.o sort.o granger.o qrdecomp.o correlation.o hcluster.o distance.o matmult.o lsfit.o cuseful.o gpuAco.o rpcGpuAco.o

OBJSFC := remotegpuAco_xdr.o remotegpuAco_clnt.o 

OBJS13 := @OBJS13@ 

CULA_OBJS := @CULA_OBJS@
CULA_INCS := -I@CULA_HOME@/include

#compiler/preprocessor options
INCS := -I. -I@CUDA_HOME@/include @R_INCLUDE@
PARAMS := @MISC_PARAMS@ @DEVICEOPTS@ -Xcompiler @CPICFLAGS@

#linker options
LD_PARAMS := @DEVICEOPTS@ -Xlinker @RPATHFLAG@
LIBS :=  @R_LIB@ @LIBS@

TARGETS := gputools.so

NVCC := @CUDA_HOME@/bin/nvcc 

all: $(TARGETS) 

$(TARGETS): $(OBJS13) $(CULA_OBJS) $(OBJS) $(OBJSFC)
	$(NVCC) -shared $(LD_PARAMS) $(LIBS)  $(OBJS13) $(CULA_OBJS) $(OBJSFC) $(OBJS) -o $@

$(OBJS): %.o: %.$(EXT) 
	$(NVCC) -c $(INCS) $(PARAMS) $^ -o $@

remotegpuAco_xdr.o: remotegpuAco_xdr.c
	gcc -std=gnu99 -fpic -c remotegpuAco_xdr.c

remotegpuAco_clnt.o: remotegpuAco_clnt.c
	gcc -std=gnu99 -fpic -c remotegpuAco_clnt.c

$(OBJS13): %.o: %.$(EXT)
	$(NVCC) -c $(INCS) $(PARAMS) $^ -o $@

$(CULA_OBJS): %.o: %.c
	$(NVCC) -c $(INCS) $(CULA_INCS) $(PARAMS) $^ -o $@

clean:
	rm -rf *o

.PHONY: all clean
